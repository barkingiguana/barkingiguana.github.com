---
title: "Ajax and the Rails request authenticity token"
layout: post
author: Craig
---
<p>Rails 1.2.6 introduced <a href="http://en.wikipedia.org/wiki/Cross-site_request_forgery"><abbr title="Cross Site Request Forgery">CSRF</abbr></a> protection in the form of an authenticity token which is a reasonably long string used to make sure that any PUT / POST / DELETE request you've made to an application was really generated by you (or at least your browser) doing something in the application and that you weren't tricked into submitting it by some nefarious third party.</p>

<p>Rails automatically adds this token to any forms generated by it's helpers, but when building rich Ajax applications it can be useful to be able to generate the Javascript by hand.</p>

<p>Fire this snippet into your layout just above including all the other Javascript files to get access to the authenticity token in Javascript and let you submit requests using Ajax.</p>

<pre><code>&lt;%= javascript_tag "window._token = '#{form_authenticity_token}';" %&gt;</code></pre>

<p>Now you can build Ajax requests that are allowed to do stuff to the application.</p>

<pre><code class="javascript">new Ajax.Request('/foo.json', {
  method: 'PUT',
  parameters: {
    authenticity_token: window._token,
    text: $F('foo_text')
  }
  /* callbacks omitted for brevity */
})</code></pre>
